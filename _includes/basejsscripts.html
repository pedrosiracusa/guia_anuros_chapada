<script src="{{ "/assets/javascript/bootstrap/jquery.min.js" | relative_url }}"></script>
<script src="{{ "/assets/javascript/bootstrap/bootstrap.bundle.min.js" | relative_url }}"></script>

<script type="text/javascript">

    var allSpecies=[];
    var selectedSpecies;
    const btnFiltrarNoturnas = new bootstrap.Button('#filtrar-especies-noturnas')
    




    window.onload = function(){

        // Read species data
        fetch('species.json')
            .then(response => response.json() )
            .then( speciesData => {
                allSpecies = speciesData;
                selectedSpecies = new Set(allSpecies.map(sp=>sp.id));
            })

        // Register click events on buttons

        const buttons = document.querySelectorAll('.btn');
        buttons.forEach( btn =>{
            btn.addEventListener("click", (event)=>{
                switch(event.target.id){
                    case 'filtro-noturnas':
                        toggleFiltrarNoturnas(event.target)
                        break
                    case 'filtro-diurnas':
                        console.log("Diurnas")
                        break
                }
            })
        })
            
    }

    function toggleFiltrarNoturnas(btn){

        const btnActive = btn.classList.contains('active') ? true : false
        if (btnActive){
            const filteredSpecies = this.allSpecies.filter( sp => sp.atividade_not===1 ).map( sp=> sp.id );
            this.selectedSpecies = this.selectedSpecies.intersection( new Set(filteredSpecies) )
            this.selectedSpecies.forEach(hide)           
        }
        else{
            this.selectedSpecies = new Set(allSpecies.map(sp=>sp.id)); 
            this.selectedSpecies.forEach(show)
        }

        console.log(selectedSpecies)


    }       

    function clickFiltrarDiurnas(){
        const filteredSpecies = this.allSpecies.filter( sp => sp.atividade_diu===0 ).map( sp=> sp.id );
        selectedSpecies = selectedSpecies.intersection( new Set(filteredSpecies) )
        selectedSpecies.forEach(hide)
    }

    function filtrarComuns(speciesData){
        return speciesData.filter(
            species => (species.detectability_ff===0 && species.detectability_f===0)
        )


    }

    


    function hide(speciesToHide){
        let element = document.querySelectorAll(`[data-species="${speciesToHide}"]` )
        element[0].style.display = "none"
    }
    function show(speciesToShow){
        let element = document.querySelectorAll(`[data-species="${speciesToShow}"]` )
        element[0].style.display = "block"
    }

</script>